<layout name="layout" />
<div class="blog"  >
  	<div class="message-contend">
  		<h2 class="messge-pall-left" >留言板</h2>
  		<div  class="messge-pall-right messge-pall" >
  			
  			<i class="icon iconfont  icon-fenxiang">
  				
  			</i>分享
  		</div>
  		<div class="message-boths">
  			<div class="messge-pall-right">
  				<a></a>
  			</div>
  		</div>
  		<div class="message-boths" >
  			<p class="line_height" >德才兼备  自强不息</p>
  			<p class="line_height">有任何问题以及建议都可以给我留言</p>
  		</div>
  		<div class="line_height">
  			<span class="messge-pall-left" >发表我的评论</span>
  			<span class="messge-pall-right" >
  				<button class="btn comment_btn">取消评论</button>
  			</span>
  		</div>
  	</div>
  	<div class="comt message-boths" >
  		<!--<div contentEditable="true" id="editor"  class="con input-block-level comt-area"  ></div> --> 
  		<textarea placeholder="来都来了，说点什么吧…" style="width: 100%;min-height: 30px;" class="input-block-level comt-area" name="editor" id="editor" cols="100%" rows="3" tabindex="1"  >
  			
  		</textarea>
  	</div>
  	<div class="margin-top-10 emotion-height" >
  		<span class="messge-pall-left  emoticon">
  			<i class="icon iconfont  icon-biaoqing">表情</i>
  		</span>
  		<label class="messge-pall-right message-reply">
  			<input type="checkbox" name="comment_mail_notify" id="comment_mail_notify" value="comment_mail_notify"  class="vertical"  >
  			有人回复及时通知我
  			<button class="btn btn_submit"  name="submit" id="submits" tabindex="5" >
  				<!--<i class="icon iconfont icon-pingluncomment43" class="vertical"  ></i>--> 
  				<i class="icon iconfont icon-3tuihuanhuozhengcegouxuan" class="vertical"  style="font-size: 16px;"  ></i> 
  				  <label style="position: relative;top: -2px;" > 提交评论 	</label>
  			</button>
  			
  		</label>
  	</div>
  	<div class="prompt" style="display: none;"  >
  		<p style="float: right;color: red;font-size: 16px;padding-right: 80px;">请勾选填写昵称和邮箱</p>
  	</div>
  	<div id="comment_smilies" class="hide message-boths message-margin-bottom" >
  		
	</div>
	<!--填入邮箱信息-->
	<div class="mailbox margin-top-10 message-boths fill-height"  >
		 <span style="" >
			<h4>hello！你需要填写昵称和邮箱哦(*^__^*) </h4>
		</span>
		<span >
			<ul>
				<li class="line_height message-margin">
					<label class="input_lable" >昵称（必填）:</label>
					<input type="text" name="name" id="name" class="input_text name" maxlength="12" placeholder="昵称..." onkeyup="value=value.replace(/[^\a-\z\A-\Z0-9\u4E00-\u9FA5\@\.]/g,'')"  />
				</li>
				<li class="line_height message-margin">
					<label class="input_lable">邮箱（必填）:</label>
					<input type="text" name="email" id="email" class="input_text email" placeholder="邮箱..."  />
				</li>
				<li class="line_height message-margin">
					<label class="input_lable">网址:</label>
					<input type="text" name="website" id="website" class="input_text website" placeholder="网址..." />
				</li>
				
			</ul>
		</span>
	</div>
	<div class="message-boths color_word" >
		<i class="icon iconfont  icon-liuyan" class="vertical"  ></i>
		<b>10</b>
		个小伙伴正在吐槽
	</div>
	<hr class="hr_message"/>
	
	<div class="ul-padding" >
		<volist name="info" id="val" >
			<ul>
				<li>
					<div  class="message_blog"   >
						<img class="title_img" src='http://gravatar.duoshuo.com/avatar/fba7ce4051ec01fd3efc50a0f3ecac5a?s=108&d=http%3A%2F%2Fwww.xuechenlei.com%2Fwp-content%2Fthemes%2FGit%2Fcss%2Fimg%2Fdefault.png&r=g 2x'  />
						<span>
							<div >
								{$val.content}
							</div>
							<div >
								<label>{$val.name}&nbsp;&nbsp;2018-03-25</label>
								<a  class="reply_leave color_word" name="{$val.id}" onclick="reply(this)" >回复</a>
							</div>
						</span>
					</div>
					<div  class="reply_text" style="display: none;" >
					 	<textarea placeholder="来都来了，说点什么吧…" class="input-block-level comt-area" name="comment" class="comment" cols="100%" rows="3" tabindex="1"  >
						</textarea>
						<div>
							<button class="btn-sure" onclick="sure(this)" >确定</button>
							<button class="btn_cancle" onclick="cancel(this)" >取消</button>
						</div>
					</div>
					<!--<ul style="display: none;">
						<li>
							<div  class="message_blog"   >
								<img class="title_img" src='http://gravatar.duoshuo.com/avatar/fba7ce4051ec01fd3efc50a0f3ecac5a?s=108&d=http%3A%2F%2Fwww.xuechenlei.com%2Fwp-content%2Fthemes%2FGit%2Fcss%2Fimg%2Fdefault.png&r=g 2x'  />
								<span>
									<div >
										{$val.content}
									</div>
									<div >
										<label>{$val.name}&nbsp;&nbsp;2018-03-25</label>
										<a  class="reply_leave color_word" name="{$val.id}" onclick="reply(this)" >回复</a>
									</div>
								</span>
							</div>
							<div  class="reply_text" style="display: none;" >
							 	<textarea placeholder="来都来了，说点什么吧…" class="input-block-level comt-area" name="comment" class="comment" cols="100%" rows="3" tabindex="1"  >
								</textarea>
								<div>
									<button class="btn-sure" onclick="sure(this)" >确定</button>
									<button class="btn_cancle" onclick="cancel(this)" >取消</button>
								</div>
							</div>
							
						</li>
					</ul>-->
				</li>
			</ul>
		</volist>
				
	</div>
	
  </div>
  
  <aside>
  	jbojkj
  </aside>
 <script type="text/javascript" src="__PUBLIC__/js/message.js" ></script>
 <script type="text/javascript">
 
   	var img_block = 1;
   	$('.emoticon').click(function(){
		$.ajax({
			type:"post",
			url:"{:url('Messages/messages_ajax')}",
			async:true,
			data:{"id":1},
			success:function(data){
				var data = JSON.parse(data);
				var img_url = data.data;
				var img = '';
				for(var i = 0; i<img_url.length; i++ ){
					var img_attr = img_url[i].slice(0,img_url[i].length-4);//给每个标识
					img += "<img  data-smile="+img_attr+" src='__PUBLIC__/images/arclist/"+img_url[i]+"' onclick='employs(this)' />";
				}
				var img_employ = document.getElementById('comment_smilies');
				img_employ.innerHTML = img;
			}
		});
		if(img_block == 1){
			$('#comment_smilies').css('display','block');
			img_block = 0;
		}else if(img_block == 0){
			$('#comment_smilies').css('display','none');
			img_block = 1;
		}
	});
	function employs(aa){
		var img_src = $(aa).attr('data-smile');//获取图片自定义的属性
		var employ = ":"+img_src+":";
		var tet = $('#editor').val();
		if($.trim(tet)==""){ //判断输入框的内容是否为空
		 	$('#editor').val("  "+employ+"  ");
		}else{
		 	$('#editor').val(tet+"   "+employ);
		}
		$('#comment_smilies').css('display','none');
	}
	$('.btn_submit').click(function(){
		var name = $('#name').val();
		var email = $('#email').val();
		var website = $('#website').val();
		var editor = $('#editor').val();
		 $.ajax({
		 	type:"post",
		 	url:"{:url('Messages/comment')}",
		 	data:{'name':name,'email':email,'website':website,'editor':editor},
		 	async:true,
		 	success:function(data){
		 		var datas = JSON.parse(data);
		 		if(datas.msg == 1){
		 			location.reload();
		 			$('.mailbox').css('display','none');
		 			$('#comment_mail_notify').attr('checked',false);
					
		 		}else{
		 			
		 		}
		 	}
		 });
	});
	function reply(aa){
		var  coment_id =  $(aa).attr('name');
		$('.reply_text').css('display','none');
		$(aa).parents('.message_blog').next('.reply_text').css('display','block');
		$(aa).parents('.message_blog').next('.reply_text').attr("anwser_id",coment_id);
	};
	//回复确定
	function sure(replay){
	    var anwser_id	= $(replay).parents('.reply_text').attr('anwser_id'); //回复哪条评论的id
	    var comments = $(replay).parent().prev().val();
	    var pares = $(replay).parent().parent().parent();
	    console.log(pares);
		if($.trim(comments)==""){ //判断输入框里面的内容为空
				return false;
		}
//		$.ajax({
//		 	type:"post",
//		 	url:"{:url('Messages/replay')}",
//		 	data:{'anwser_id':anwser_id,'comments':comments},
//		 	async:true,
//		 	success:function(data){
//		 		var dates = JSON.parse(data);
//		 		if(dates.msg == 1){
//		 			
//		 		}
//		 	}
//		 });
	}
	//取消回复
	function cancel(aa){
		$(aa).parents('.reply_text').css("display",'none'); //找到当前这个让其取消
		$(aa).parent().prev().val("");
	}
 </script>

